---
title: "SBD2_loan_sample_09"
author: "xy"
date: '2023'
output:
html_document:
df_print: paged
HTML: default
word_document: default
pdf_document: default
---

# Inroduction

xy


We call all the libraries that we are going to use and install the packeges when its needed.
```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)

libraries = c("readr", "ggplot2", "dlookr", "dplyr", "RColorBrewer")

lapply(libraries, function(x) if (!(x %in% installed.packages())) {
  install.packages(x)
})

lapply(libraries, library, quietly = TRUE, character.only = TRUE)
```

We remove the environment and set the seed to make sure that the results gone be the same
```{r}
rm(list=ls())

set.seed(7)
```

We import the csv file "loan_sample_9.csv" and make a copy of it to ensure that we don't mess up the original dataset
```{r setup, include=FALSE, echo=FALSE}
data_loans <- read_csv("loan_sample_9.csv")
#We make a copy from the original dataset and we will work with the copy
data <- data_loans
```

# Descriptive analysis 
## Structure and dimensions of the data set

In the first step we explore the dara and run some preliminary descriptive analytics

We start by investigating the structure of the data set.
```{r, echo=FALSE}
head(data)
tail(data)

str(data)
```

```{r}
summary(data)
```
annual_inc = 3rd Qu.:77000 to Max.:400000
revol_bal = 3rd Qu.:15792 to Max.:78762
tot_cur_bal & total_rev_hi_lim similar observation

# Data quality issues 
## Checking for NAs
One of the key data quality issues is missing data. In the next step, we using the apply() function to check the presence of NAs in each of the variables included in the dataset.
```{r}
apply(data, 2, function(x) any(is.na(x)))
```

```{r, echo=FALSE}
overview(data) 
```
Zero missing values
```{r}
overview <- overview(data)
plot(overview)
```
In the next step, we set character variables as factor.
```{r}
data$grade = as.factor(data$grade)
data$home_ownership = as.factor(data$home_ownership)
data$verification_status = as.factor(data$verification_status)
data$purpose = as.factor(data$purpose)
data$application_type = as.factor(data$application_type)
data$Status = as.factor(data$Status)

overview <- overview(data)
plot(overview)
```
We go to check the data structure of the factor variables in the dataframe

## Status of loan sample
In the next step, we investigate our target variable. We notice that in our sample, we have 34'794 persons which did not default on their loan and we have 5'206 which did default.

```{r}
summary(data %>%
  select_if(is.factor))
```
 
Visualization of the level of the target variable
```{r}
ggplot(data, aes(x = loan_amnt / 1000)) +
  geom_histogram(fill = "skyblue",
                 color = "white",
                 bins = 10) +
  facet_grid(grade ~ Status) +                 # the format here is row variable ~ column variable 
  labs(title = "Loan histograms by status and grade",
       x = "Loan ($1,000)")
```
ggplot(data, aes(x = data$Status)) +
  geom_bar() +
  labs(title = "Bar Plot of Target Variable", x = "Status", y = "Loan")
#Stimmt x y Bezeichnung, #Is it balanced?


#Check distribution of the numeric variables
# Create histograms for numeric variables
for (col in names(data)) {
  if (is.numeric(data[[col]])) {
    print(ggplot(data, aes(x = data[[col]])) +
            geom_histogram(binwidth = 0.5) +
            labs(title = paste("Histogram of", col)))
  }
}

#Create density plots for numeric variables
for (col in names(data)) {
  if (is.numeric(data[[col]])) {
    print(ggplot(data, aes(x = data[[col]])) +
            geom_density() +
            labs(title = paste("Density Plot of", col)))
  }
}


#Variables contain outliers
ggplot(data, aes(x = data$Status)) +
  geom_bar(size = 1,
           outlier.shape = 1, 
           outlier.color = "black",
           outlier.size = 3) 


#Target value with default
ggplot(Default, aes(x  = default, 
                    y = status)) +
  geom_boxplot(fill = "steelblue", 
               alpha = .5) +
  labs(title = "XY distribution by default status")




######################################################



# -------------------------------- COMBINING GRAPHS ---------------------------------------#
# Plot the distribution of salaries by rank using jittering
# Let's also improve the graph. We are changing the labels of the Rank variable 
# and we are adding some graph features.

ggplot(Salaries, 
       aes(x = factor(rank,
                      labels = c("Assistant\nProfessor",
                                 "Associate\nProfessor",
                                 "Full\nProfessor")), 
           y = salary, 
           color = rank)) +
  geom_boxplot(size = 1,                         # size of the box plot
               outlier.shape = 1,                # shape of the outlier
               outlier.color = "black",          # color of the outlier
               outlier.size  = 3) +              # size of the outlier
  geom_jitter(alpha = 0.5, 
              width = .2) + 
  scale_y_continuous(label = dollar) +
  labs(title = "Academic Salary by Rank", 
       subtitle = "9-month salary for 2008-2009",
       x = "",
       y = "") +
  theme_minimal() +
  theme(legend.position = "none") 


# DATA VISUALIZATION V
# Calculate the correlations between the variables 
corr <- cor(economics[-1])
corr

# Visualization methods - full matrix 
?corrplot
corrplot(corr) # default method is the circle 
corrplot(corr, method = "pie") # we can also change the method 
corrplot(corr, method = "color")
corrplot(corr, method = "number")

#####################################################

# Boxplot
ggplot(Default, aes(x  = default, 
                    y = income)) +
  geom_boxplot(fill = "steelblue", 
               alpha = .5) +
  labs(title = "Income distribution by default status")

######################################################